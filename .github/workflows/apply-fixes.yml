name: ğŸ”§ Apply AI Optimizations
on:
  workflow_dispatch:  # Permite ejecuciÃ³n MANUAL desde GitHub UI
  push:
    branches: [ main ]
    paths:
      - 'td_script.js'  # Solo se activa si cambia este archivo

jobs:
  apply-optimizations:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # âš ï¸ NECESARIO para hacer push
    
    steps:
      # 1. Descargar el cÃ³digo
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      # 2. Configurar Git
      - name: âš™ï¸ Configure Git
        run: |
          git config user.name "GitHub AI Assistant"
          git config user.email "ai-assistant@github.com"
          git config pull.rebase false
      
      # 3. PRUEBA SEGURA: Solo aÃ±ade un comentario
      - name: ğŸ”§ Apply AI Optimizations (PRUEBA)
        run: |
          echo "ğŸ§ª PRUEBA INICIAL - No modifica lÃ³gica"
          
          # AÃ±adir comentario al inicio (INOFENSIVO)
          if grep -q "ğŸš€ OPTIMIZADO via GitHub Actions" td_script.js; then
            echo "âœ… Ya tiene el comentario, omitiendo..."
          else
            sed -i '1s|^|// ğŸš€ OPTIMIZADO via GitHub Actions - Inicializado\n|' td_script.js
            echo "ğŸ“ Comentario aÃ±adido"
          fi
          
          # Contar lÃ­neas (solo para ver)
          echo "ğŸ“Š LÃ­neas actuales: $(wc -l < td_script.js)"
      
      # 4. Mostrar cambios (sin commit aÃºn)
      - name: ğŸ“‹ Preview Changes
        run: |
          echo "ğŸ” Vista previa de cambios:"
          git diff td_script.js || echo "No hay cambios aÃºn"
          
      # 5. OPCIONAL: ConfirmaciÃ³n manual (comenta/descomenta)
       - name: ğŸš€ Commit & Push Changes
         if: success()
         run: |
           if git diff --quiet td_script.js; then
             echo "âš ï¸ No hay cambios"
             exit 0
           fi
           git add td_script.js
           git commit -m "ğŸ¤– PRUEBA: ConfiguraciÃ³n inicial"
           git push origin main
